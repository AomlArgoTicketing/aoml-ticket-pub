name: Sync Public Issues to Private Repo

on:
  issues:
    types: [opened]

jobs:
  sync_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create Internal Issue
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.PAT_SECRET }}
          script: |
            const issue = context.payload.issue;
            const title = issue.title;
            const body = issue.body;
            const public_url = issue.html_url;
            
            // Extract labels from the public issue
            const labels = issue.labels.map(label => label.name); 

            console.log("Extracted Labels:", labels); // âœ… Debugging: Print labels

            // Ensure "Synced from Public" label is always included
            if (!labels.includes("Synced from Public")) {
              labels.push("Synced from Public");
            }

            // Create issue in private repo
            const createdIssue = await github.rest.issues.create({
              owner: 'TicketTesting77',  // Update if needed
              repo: 'aoml-internal-tracking',  // Private repo
              title: `[Public #${issue.number}] ${title}`,
              body: `### ðŸ”— Linked Public Issue: [View Issue](${public_url})\n\n---\n${body}`
            });

            console.log("Created Issue Number:", createdIssue.data.number);  // âœ… Debugging

            // Apply labels separately after issue creation
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: 'TicketTesting77',
                repo: 'aoml-internal-tracking',
                issue_number: createdIssue.data.number,
                labels: labels
              });
              console.log(`Labels added: ${labels.join(", ")}`);  // âœ… Debugging: Confirm applied labels
            } else {
              console.log("No labels detected, skipping label addition.");
            }

            // Post confirmation comment in public issue
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: "âœ… This issue has been **logged internally** and is now being reviewed by our team."
            });
